<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />

		<title>Raspberry Pi CO2 Monitor</title>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	</head>

	<body onload="go()">

		<center>
			<div class='container'>
			  <form action="/blink" method="get">
		 	    <input type="submit" id='led' value="Blink LED">
			  </form>
			</div>
			<div id="gauge" style="width: 250px; height: 250px"></div>
			<div id="curve_chart" style="width: 1200px; height: 1200px"></div>
		</center>

		<script type='text/javascript'>
			$(document).ready(function(){
			  var $form = $('form');
			  $form.submit(function(){
			    $.get($(this).attr('action'), $(this).serialize(), function(response){},'json');
			    return false;
			  });
			});
		</script>

		<script type='text/javascript'>
			//Load the charts libraries
			google.charts.load('current', { packages: ['corechart'] });
			//create empty array as a global
			var chartData = [];
			//This function is called when the page loads
			function go(){
				goTime = new Date();
				console.log('It\'s Go Time! '+goTime);
				getData();
				setInterval(function() {
					xTime = new Date();
					console.clear();
					console.log('Update Initiated: '+xTime);
					getData();
				}, 60000);
			}
			//Grabs the data from the sqlData app.route and pushes it into an array
			function getData(){
				//Clear the array first
				chartData = [];
				$.getJSON('/sqlData', function(chartJSON) {
					console.log(chartJSON);
					for (i = 0; i < chartJSON.length; i++){
						chartData.push([new Date(chartJSON[i].Date), chartJSON[i].Temperature]);
					};
					drawChart();
				});
			}
		
	        //Draws the chart
	        function drawChart() {
				var gdata = new google.visualization.DataTable();
				gdata.addColumn('date', 'Date');
				gdata.addColumn('number', 'Temperature');
				gdata.addRows(chartData);

				var options = {
				    title: 'Temperture Log',
	            		    curveType: 'function',
	            		    legend: { position: 'bottom' }
	        		};
	        		var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
	        		chart.draw(gdata, options);
	        		chartTime = new Date();
			}

		</script>


	</body>

</html>
